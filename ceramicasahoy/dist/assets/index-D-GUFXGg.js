import{r as e,b as r,R as t}from"./vendor-B8XeDuRh.js";import{C as s,r as a,u as n,w as o}from"./utils-IqWdvbVm.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&r(e)}).observe(document,{childList:!0,subtree:!0})}function r(e){if(e.ep)return;e.ep=!0;const r=function(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?r.credentials="include":"anonymous"===e.crossOrigin?r.credentials="omit":r.credentials="same-origin",r}(e);fetch(e.href,r)}}();var l={exports:{}},i={},c=e,d=Symbol.for("react.element"),m=Symbol.for("react.fragment"),u=Object.prototype.hasOwnProperty,x=c.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h={key:!0,ref:!0,__self:!0,__source:!0};function g(e,r,t){var s,a={},n=null,o=null;for(s in void 0!==t&&(n=""+t),void 0!==r.key&&(n=""+r.key),void 0!==r.ref&&(o=r.ref),r)u.call(r,s)&&!h.hasOwnProperty(s)&&(a[s]=r[s]);if(e&&e.defaultProps)for(s in r=e.defaultProps)void 0===a[s]&&(a[s]=r[s]);return{$$typeof:d,type:e,key:n,ref:o,props:a,_owner:x.current}}i.Fragment=m,i.jsx=g,i.jsxs=g,l.exports=i;var p,f=l.exports,b=r;p=b.createRoot,b.hydrateRoot;
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var y={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};
/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=(r,t)=>{const s=e.forwardRef(({color:s="currentColor",size:a=24,strokeWidth:n=2,absoluteStrokeWidth:o,className:l="",children:i,...c},d)=>{return e.createElement("svg",{ref:d,...y,width:a,height:a,stroke:s,strokeWidth:o?24*Number(n)/Number(a):n,className:["lucide",`lucide-${m=r,m.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim()}`,l].join(" "),...c},[...t.map(([r,t])=>e.createElement(r,t)),...Array.isArray(i)?i:[i]]);var m});return s.displayName=`${r}`,s},v=j("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),N=j("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),w=j("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),k=j("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),C=j("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),S=j("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),E=j("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),P=j("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),I=j("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),_=j("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),M=j("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),A=j("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),O=j("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),L=j("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]),D=j("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),z=j("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),$=j("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),F=j("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),B=j("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),R=j("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),q=j("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),U=j("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]),V=j("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),T=j("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),H=j("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),G=j("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Y=j("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),K=j("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),W=256,Z=16,J=16,X=1e4,Q=5,ee=9e5;class re{constructor(){this.loginAttempts=new Map}static getInstance(){return re.instance||(re.instance=new re),re.instance}static sanitizeInput(e){return e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+\s*=/gi,"").trim()}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static validatePassword(e){const r=[];return e.length<8&&r.push("La contraseña debe tener al menos 8 caracteres"),/[A-Z]/.test(e)||r.push("La contraseña debe contener al menos una mayúscula"),/[a-z]/.test(e)||r.push("La contraseña debe contener al menos una minúscula"),/\d/.test(e)||r.push("La contraseña debe contener al menos un número"),/[!@#$%^&*(),.?":{}|<>]/.test(e)||r.push("La contraseña debe contener al menos un carácter especial"),{valid:0===r.length,errors:r}}checkLoginAttempts(e){const r=this.loginAttempts.get(e),t=Date.now();if(!r)return{allowed:!0,remainingAttempts:Q};if(r.count>=Q){const s=r.lastAttempt+ee;return t<s?{allowed:!1,remainingAttempts:0,lockoutTime:s}:(this.loginAttempts.delete(e),{allowed:!0,remainingAttempts:Q})}return{allowed:!0,remainingAttempts:Q-r.count}}recordLoginAttempt(e,r){if(r)return void this.loginAttempts.delete(e);const t=this.loginAttempts.get(e)||{count:0,lastAttempt:0};t.count++,t.lastAttempt=Date.now(),this.loginAttempts.set(e,t)}cleanupOldAttempts(){const e=Date.now()-ee;for(const[r,t]of this.loginAttempts.entries())t.lastAttempt<e&&this.loginAttempts.delete(r)}}const te=[{id:"1",name:"Herramientas",image:"https://images.pexels.com/photos/162553/keys-workshop-mechanic-tools-162553.jpeg?auto=compress&cs=tinysrgb&w=800",description:"Herramientas y gestión",is_management:!0,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{id:"2",name:"Interceramic",image:"https://images.pexels.com/photos/1571460/pexels-photo-1571460.jpeg?auto=compress&cs=tinysrgb&w=800",description:"Click para explorar catálogo",is_management:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{id:"3",name:"Condumex",image:"https://images.pexels.com/photos/257736/pexels-photo-257736.jpeg?auto=compress&cs=tinysrgb&w=800",description:"Click para explorar catálogo",is_management:!1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()}],se={id:"admin-1",username:"admin",email:"admin@sistema.com",role:"admin",created_at:(new Date).toISOString()},ae=class{static setSecureItem(e,r){try{const a=JSON.stringify(r);try{const r=function(e,r){try{const t=s.lib.WordArray.random(J),a=s.PBKDF2(r,t,{keySize:W/32,iterations:X}),n=s.lib.WordArray.random(Z),o=s.AES.encrypt(e,a,{iv:n});return t.concat(n).concat(o.ciphertext).toString(s.enc.Base64)}catch(t){throw new Error("Error al encriptar los datos")}}(a,this.ENCRYPTION_KEY);localStorage.setItem(e,r)}catch(t){localStorage.setItem(e,a)}}catch(a){}}static getSecureItem(e,r){try{const n=localStorage.getItem(e);if(!n)return r;try{const e=function(e,r){try{const t=s.enc.Base64.parse(e),a=s.lib.WordArray.create(t.words.slice(0,J/4)),n=s.lib.WordArray.create(t.words.slice(J/4,(J+Z)/4)),o=s.lib.WordArray.create(t.words.slice((J+Z)/4)),l=s.PBKDF2(r,a,{keySize:W/32,iterations:X});return s.AES.decrypt({ciphertext:o},l,{iv:n}).toString(s.enc.Utf8)}catch(t){throw new Error("Error al desencriptar los datos")}}(n,this.ENCRYPTION_KEY);return JSON.parse(e)}catch(t){try{return JSON.parse(n)}catch(a){return r}}}catch(n){return r}}static getUsers(){return this.getSecureItem("users",[se])}static saveUsers(e){this.setSecureItem("users",e)}static createUser(e){const r=this.getUsers();if(r.find(r=>r.username.toLowerCase()===e.username.toLowerCase()||r.email.toLowerCase()===e.email.toLowerCase()))throw new Error("Usuario o email ya existe");const t={...e,id:this.generateId(),created_at:(new Date).toISOString()};return r.push(t),this.saveUsers(r),t}static signIn(e,r){const t=this.getUsers();if(("admin"===e||"admin@sistema.com"===e)&&"Tesla369@"===r){const e=t.find(e=>"admin"===e.username)||se;e.last_login=(new Date).toISOString();const r=t.map(r=>r.id===e.id?e:r);t.find(r=>r.id===e.id)||r.push(e),this.saveUsers(r);const s={user:e,token:this.generateSecureToken(),expires_at:new Date(Date.now()+864e5).toISOString(),created_at:(new Date).toISOString()};return this.setSecureItem(this.SESSION_KEY,s),s}throw new Error("Credenciales incorrectas")}static getCurrentSession(){const e=this.getSecureItem(this.SESSION_KEY,null);return e?new Date(e.expires_at)<new Date?(this.signOut(),null):e:null}static signOut(){localStorage.removeItem(this.SESSION_KEY)}static getBrands(){return this.getSecureItem("brands",te)}static saveBrands(e){this.setSecureItem("brands",e)}static createBrand(e){const r=this.getBrands();if(r.find(r=>r.name.toLowerCase()===e.name.toLowerCase()))throw new Error(`Ya existe una marca con el nombre "${e.name}"`);const t={...e,id:this.generateId(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return r.push(t),this.saveBrands(r),t}static updateBrand(e,r){const t=this.getBrands(),s=t.findIndex(r=>r.id===e);return-1===s?null:(t[s]={...t[s],...r,updated_at:(new Date).toISOString()},this.saveBrands(t),t[s])}static deleteBrand(e){const r=this.getBrands(),t=r.filter(r=>r.id!==e);if(t.length===r.length)return!1;this.saveBrands(t);const s=this.getProducts().filter(r=>r.brand_id!==e);return this.saveProducts(s),!0}static getProducts(){return this.getSecureItem("products",[])}static saveProducts(e){this.setSecureItem("products",e)}static getProductsByBrand(e,r=1,t=12,s=""){const a=this.getProducts(),n=this.getBrands();let o=a.filter(r=>r.brand_id===e).map(e=>({...e,brand:n.find(r=>r.id===e.brand_id)}));if(s.trim()){const e=s.toLowerCase();o=o.filter(r=>r.name.toLowerCase().includes(e)||r.description.toLowerCase().includes(e)||r.key.toLowerCase().includes(e)||r.barcode.toLowerCase().includes(e))}const l=o.length,i=(r-1)*t;return{products:o.slice(i,i+t),total:l}}static createProduct(e,r=[]){const t=this.getProducts();if(t.find(r=>r.barcode===e.barcode))throw new Error(`Ya existe un producto con el código de barras "${e.barcode}"`);if(t.find(r=>r.key===e.key))throw new Error(`Ya existe un producto con la clave "${e.key}"`);const s={...e,id:this.generateId(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return r.length>0&&(s.parameters=r.map(e=>({...e,id:this.generateId(),product_id:s.id,created_at:(new Date).toISOString()}))),t.push(s),this.saveProducts(t),s}static createProductsBatch(e){const r=this.getProducts(),t=[],s=[];for(const{product:n,parameters:o}of e)try{if([...r,...t].find(e=>e.barcode===n.barcode)){s.push(`Código de barras duplicado: ${n.barcode}`);continue}if([...r,...t].find(e=>e.key===n.key)){s.push(`Clave duplicada: ${n.key}`);continue}const e={...n,id:this.generateId(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};o.length>0&&(e.parameters=o.map(r=>({...r,id:this.generateId(),product_id:e.id,created_at:(new Date).toISOString()}))),t.push(e)}catch(a){s.push(`Error en producto ${n.name}: ${a instanceof Error?a.message:"Error desconocido"}`)}return t.length>0&&this.saveProducts([...r,...t]),s.length,t}static updateProduct(e,r,t=[]){const s=this.getProducts(),a=s.findIndex(r=>r.id===e);return-1===a?null:(s[a]={...s[a],...r,updated_at:(new Date).toISOString(),parameters:t.length>0?t.map(r=>({...r,id:this.generateId(),product_id:e,created_at:(new Date).toISOString()})):s[a].parameters},this.saveProducts(s),s[a])}static deleteProduct(e){const r=this.getProducts(),t=r.filter(r=>r.id!==e);return t.length!==r.length&&(this.saveProducts(t),!0)}static clearAllProducts(){const e=this.getProducts().length;return this.saveProducts([]),{success:!0,message:`Eliminados ${e} productos del almacenamiento local`,products_deleted:e}}static clearBrandProducts(e){const r=this.getProducts(),t=r.filter(r=>r.brand_id===e),s=r.filter(r=>r.brand_id!==e);return this.saveProducts(s),{success:!0,message:`Eliminados ${t.length} productos de la marca`,products_deleted:t.length}}static getExcelFormats(){return this.getSecureItem("excel_formats",[])}static saveExcelFormats(e){this.setSecureItem("excel_formats",e)}static getExcelFormatsByBrand(e){return this.getExcelFormats().filter(r=>r.brand_id===e)}static createExcelFormat(e,r=[]){const t=this.getExcelFormats(),s={...e,id:this.generateId(),created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return r.length>0&&(s.fields=r.map((e,r)=>({...e,id:this.generateId(),format_id:s.id,order_index:r,created_at:(new Date).toISOString()}))),t.push(s),this.saveExcelFormats(t),s}static hasPermission(e,r,t){return"admin"===e||("manager"===e?("brands"!==r||"delete"!==t)&&("users"!==r&&["brands","products","excel_formats"].includes(r)):"viewer"===e&&"read"===t)}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static generateSecureToken(){const e=new Uint8Array(32);return crypto.getRandomValues(e),Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}static exportData(){const e={brands:this.getBrands(),products:this.getProducts(),formats:this.getExcelFormats(),users:this.getUsers(),exported_at:(new Date).toISOString()};return JSON.stringify(e,null,2)}static importData(e){try{const r=JSON.parse(e);return r.brands&&this.saveBrands(r.brands),r.products&&this.saveProducts(r.products),r.formats&&this.saveExcelFormats(r.formats),r.users&&this.saveUsers(r.users),{success:!0,message:"Datos importados exitosamente"}}catch(r){return{success:!1,message:`Error al importar datos: ${r instanceof Error?r.message:"Error desconocido"}`}}}static clearAllData(){localStorage.clear()}};ae.STORAGE_KEY="interceramic_catalog_data",ae.SESSION_KEY="interceramic_session",ae.ENCRYPTION_KEY="interceramic_2024_secure_key";let ne=ae;class oe{constructor(){this.currentSession=null,this.securityManager=re.getInstance(),this.loadCurrentSession()}static getInstance(){return oe.instance||(oe.instance=new oe),oe.instance}loadCurrentSession(){this.currentSession=ne.getCurrentSession()}async signIn(e,r){const t=re.sanitizeInput(e),s=re.sanitizeInput(r),a=this.securityManager.checkLoginAttempts(t);if(!a.allowed){const e=a.lockoutTime?new Date(a.lockoutTime):new Date;throw new Error(`Demasiados intentos fallidos. Intenta de nuevo después de ${e.toLocaleTimeString()}`)}try{const e=ne.signIn(t,s);return this.currentSession=e,this.securityManager.recordLoginAttempt(t,!0),e}catch(n){throw this.securityManager.recordLoginAttempt(t,!1),n}}async signUp(e,r,t,s="viewer"){const a=re.sanitizeInput(e),n=re.sanitizeInput(t),o=re.sanitizeInput(r);if(!re.validateEmail(a))throw new Error("Email inválido");const l=re.validatePassword(o);if(!l.valid)throw new Error(l.errors.join(", "));return ne.createUser({username:n,email:a,role:s})}async getCurrentSession(){return this.currentSession}async getCurrentUser(){var e;return(null==(e=this.currentSession)?void 0:e.user)||null}async signOut(){ne.signOut(),this.currentSession=null}async hasPermission(e,r){const t=await this.getCurrentUser();return!!t&&ne.hasPermission(t.role,e,r)}async isAdmin(){const e=await this.getCurrentUser();return"admin"===(null==e?void 0:e.role)}async canManageContent(){const e=await this.getCurrentUser();return"admin"===(null==e?void 0:e.role)||"manager"===(null==e?void 0:e.role)}async canManageUsers(){const e=await this.getCurrentUser();return"admin"===(null==e?void 0:e.role)}}const le=oe.getInstance(),ie=()=>{const[r,t]=e.useState(null),[s,a]=e.useState(null),[n,o]=e.useState(!0);e.useEffect(()=>{(async()=>{try{const e=await le.getCurrentSession();if(e){const r=await le.getCurrentUser();t(r),a(e)}}catch(e){t(null),a(null)}finally{o(!1)}})();const e=setInterval(async()=>{try{const e=await le.getCurrentSession();if(e){const r=await le.getCurrentUser();t(r),a(e)}else t(null),a(null)}catch(e){}},3e4);return()=>clearInterval(e)},[]);return{user:r,session:s,loading:n,userRole:(null==r?void 0:r.role)||"viewer",hasPermission:(e,t)=>!!r&&("admin"===r.role||("manager"===r.role?("brands"!==e||"delete"!==t)&&("users"!==e&&["brands","products","excel_formats"].includes(e)):"viewer"===r.role&&"read"===t)),isAdmin:async()=>await le.isAdmin(),canManageContent:async()=>await le.canManageContent(),canManageUsers:()=>"admin"===(null==r?void 0:r.role),useSupabase:!1}},ce=()=>{const[r,t]=e.useState([]),[s,a]=e.useState(!0),[n,o]=e.useState(null);ie();const l=e.useCallback(async()=>{try{a(!0),o(null);const e=ne.getBrands();t(e)}catch(e){o(e instanceof Error?e.message:"Error al cargar marcas")}finally{a(!1)}},[]),i=e.useCallback(async e=>{try{const r=ne.createBrand(e);return t(e=>[r,...e]),r}catch(r){throw new Error(r instanceof Error?r.message:"Error al crear marca")}},[]),c=e.useCallback(async(e,r)=>{try{const s=ne.updateBrand(e,r);if(s)return t(r=>r.map(r=>r.id===e?s:r)),s;throw new Error("Marca no encontrada")}catch(s){throw new Error(s instanceof Error?s.message:"Error al actualizar marca")}},[]),d=e.useCallback(async e=>{try{if(!ne.deleteBrand(e))throw new Error("Marca no encontrada");t(r=>r.filter(r=>r.id!==e))}catch(r){throw new Error(r instanceof Error?r.message:"Error al eliminar marca")}},[]),m=e.useCallback(()=>ne.exportData(),[]),u=e.useCallback(async e=>{try{const r=ne.importData(e);return r.success&&await l(),r}catch(r){throw new Error(r instanceof Error?r.message:"Error al importar datos")}},[l]);return e.useEffect(()=>{l()},[l]),{brands:r,loading:s,error:n,createBrand:i,updateBrand:c,deleteBrand:d,refetch:l,exportData:m,importData:u}},de=({onNewBrand:e,onCreateUser:r})=>{const{user:t,userRole:s,hasPermission:a}=ie(),{exportData:n,importData:o}=ce();return f.jsx("header",{className:"bg-white shadow-lg border-b border-gray-200",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:f.jsxs("div",{className:"flex items-center justify-between h-16",children:[f.jsx("div",{className:"flex items-center",children:f.jsx("div",{className:"flex-shrink-0 flex items-center",children:f.jsx("img",{src:"/logo.jpg",alt:"Logo",className:"h-12 w-auto object-contain"})})}),f.jsx("div",{className:"flex-1 max-w-3xl mx-8",children:f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:f.jsx(B,{className:"h-5 w-5 text-gray-400"})}),f.jsx("input",{type:"text",placeholder:"Buscar productos, códigos, marcas...",className:"block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl leading-5 bg-gray-50 placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-2 focus:ring-red-500 focus:border-red-500 focus:bg-white transition-all duration-200 shadow-sm"})]})}),f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),f.jsxs("span",{className:"text-xs text-gray-600 flex items-center",children:[f.jsx(q,{className:"w-3 h-3 mr-1"}),"Seguro"]})]}),a("brands","read")&&f.jsxs(f.Fragment,{children:[f.jsxs("button",{onClick:()=>{try{const e=n(),r=new Blob([e],{type:"application/json"}),t=URL.createObjectURL(r),s=document.createElement("a");s.href=t,s.download=`interceramic-backup-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}catch(e){alert("Error al exportar datos")}},className:"inline-flex items-center px-3 py-2 border border-green-300 text-sm font-medium rounded-xl text-green-700 bg-green-50 hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-all duration-200 shadow-sm hover:shadow-md",title:"Exportar datos",children:[f.jsx(S,{className:"h-4 w-4 mr-2"}),"Exportar"]}),f.jsxs("button",{onClick:()=>{const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=async e=>{var r;const t=null==(r=e.target.files)?void 0:r[0];if(t)try{const e=await t.text(),r=await o(e);r.success?(alert("Datos importados exitosamente"),window.location.reload()):alert(r.message)}catch(s){alert("Error al importar datos")}},e.click()},className:"inline-flex items-center px-3 py-2 border border-blue-300 text-sm font-medium rounded-xl text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-all duration-200 shadow-sm hover:shadow-md",title:"Importar datos",children:[f.jsx(T,{className:"h-4 w-4 mr-2"}),"Importar"]})]}),a("users","create")&&f.jsxs("button",{onClick:r,className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-xl text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200 shadow-sm hover:shadow-md",children:[f.jsx(H,{className:"h-4 w-4 mr-2"}),"Crear Usuario"]}),e&&a("brands","create")&&f.jsxs("button",{onClick:e,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-xl text-white bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200 shadow-md hover:shadow-lg",children:[f.jsx($,{className:"h-4 w-4 mr-2"}),"Nueva Marca"]}),f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-red-600 to-red-700 rounded-full flex items-center justify-center text-white text-sm font-medium shadow-lg",children:"admin"===s?"A":"manager"===s?"M":"V"}),f.jsxs("div",{className:"hidden sm:block",children:[f.jsx("div",{className:"text-sm font-medium text-gray-900",children:"admin"===s?"Administrador":"manager"===s?"Gerente":"Visualizador"}),f.jsx("div",{className:"text-xs text-red-600",children:null==t?void 0:t.username})]}),f.jsx("button",{onClick:async()=>{try{await le.signOut(),window.location.reload()}catch(e){}},className:"inline-flex items-center px-3 py-2 text-gray-600 text-sm font-medium rounded-lg hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition-colors",title:"Cerrar sesión",children:f.jsx(O,{className:"w-4 h-4"})})]})]})]})})})},me=({brand:e,onEdit:r,onImport:s,onExport:a,onExplore:n,onDelete:o})=>{const[l,i]=t.useState(!1);return f.jsx("div",{className:"relative group",children:f.jsxs("div",{className:"aspect-[4/3] rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1",onClick:n,children:[f.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"}),f.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent flex items-center justify-center",children:f.jsxs("div",{className:"text-center",children:[f.jsx("h3",{className:"text-3xl font-bold text-white mb-2 drop-shadow-lg",children:e.name}),f.jsx("p",{className:"text-white/80 text-sm drop-shadow-md",children:"Click para explorar"})]})}),f.jsxs("div",{className:"absolute top-4 right-4 z-10",children:[f.jsx("button",{onClick:e=>{e.stopPropagation(),i(!l)},className:"w-10 h-10 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white hover:bg-white/30 transition-all duration-200 shadow-lg",children:f.jsx(D,{className:"h-4 w-4"})}),l&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>i(!1)}),f.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-xl py-2 z-20 border border-gray-100",children:[r&&f.jsxs("button",{onClick:e=>{e.stopPropagation(),i(!1),r()},className:"flex items-center space-x-2 px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-600 w-full text-left transition-colors duration-200",children:[f.jsx(U,{className:"h-4 w-4"}),f.jsx("span",{children:"Editar Marca"})]}),f.jsxs("button",{onClick:e=>{e.stopPropagation(),i(!1),null==s||s()},className:"flex items-center space-x-2 px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-600 w-full text-left transition-colors duration-200",children:[f.jsx(I,{className:"h-4 w-4"}),f.jsx("span",{children:"Importar Excel"})]}),f.jsxs("button",{onClick:e=>{e.stopPropagation(),i(!1),null==a||a()},className:"flex items-center space-x-2 px-4 py-2 text-sm text-gray-700 hover:bg-red-50 hover:text-red-600 w-full text-left transition-colors duration-200",children:[f.jsx(S,{className:"h-4 w-4"}),f.jsx("span",{children:"Exportar Catálogo"})]}),f.jsx("div",{className:"border-t border-gray-200 my-2"}),o&&f.jsxs("button",{onClick:e=>{e.stopPropagation(),i(!1),o()},className:"flex items-center space-x-2 px-4 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left transition-colors duration-200",children:[f.jsx(V,{className:"h-4 w-4"}),f.jsx("span",{children:"Eliminar Marca"})]})]})]})]})]})})},ue=({isOpen:e,onClose:r,brandName:s,brandImage:a,onSave:n})=>{const[o,l]=t.useState(s),[i,c]=t.useState(a),[d,m]=t.useState(a),u=t.useRef(null);t.useEffect(()=>{l(s),c(a),m(a)},[s,a]);const x=()=>{l(s),c(a),m(a),r()};return e?f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[f.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Editar Marca"}),f.jsx("button",{onClick:x,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:f.jsx(K,{className:"h-6 w-6"})})]}),f.jsxs("div",{className:"p-6 space-y-6",children:[f.jsxs("div",{children:[f.jsx("label",{htmlFor:"brandName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nombre de la marca"}),f.jsx("input",{type:"text",id:"brandName",value:o,onChange:e=>l(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Ingresa el nombre de la marca"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Imagen de la marca"}),f.jsx("div",{className:"mb-4",children:f.jsx("div",{className:"w-full h-32 border-2 border-dashed border-gray-300 rounded-lg overflow-hidden",children:d?f.jsx("img",{src:d,alt:"Preview",className:"w-full h-full object-cover"}):f.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:f.jsx(k,{className:"h-8 w-8"})})})}),f.jsxs("button",{onClick:()=>{var e;return null==(e=u.current)?void 0:e.click()},className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",children:[f.jsx(T,{className:"h-4 w-4 mr-2"}),"Seleccionar imagen desde dispositivo"]}),f.jsx("input",{ref:u,type:"file",accept:"image/*",onChange:e=>{var r;const t=null==(r=e.target.files)?void 0:r[0];if(t){const e=new FileReader;e.onload=e=>{var r;const t=null==(r=e.target)?void 0:r.result;c(t),m(t)},e.readAsDataURL(t)}},className:"hidden"})]})]}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gray-50",children:[f.jsx("button",{onClick:x,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",children:"Cancelar"}),f.jsx("button",{onClick:()=>{n(o,i),r()},disabled:!o.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Guardar cambios"})]})]})}):null},xe=({isOpen:e,onClose:r,onSave:s})=>{const[a,n]=t.useState(""),[o,l]=t.useState(""),[i,c]=t.useState(""),d=t.useRef(null),m=()=>{u(),r()},u=()=>{n(""),l(""),c("")};return e?f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[f.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Nueva Marca"}),f.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:f.jsx(K,{className:"h-6 w-6"})})]}),f.jsxs("div",{className:"p-6 space-y-6",children:[f.jsxs("div",{children:[f.jsxs("label",{htmlFor:"brandName",className:"block text-sm font-medium text-gray-700 mb-2",children:["Nombre de la marca ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"text",id:"brandName",value:a,onChange:e=>n(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Ingresa el nombre de la marca"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Imagen de la marca"}),f.jsx("div",{className:"mb-4",children:f.jsx("div",{className:"w-full h-32 border-2 border-dashed border-gray-300 rounded-lg overflow-hidden",children:i?f.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover"}):f.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:f.jsxs("div",{className:"text-center",children:[f.jsx(k,{className:"h-8 w-8 mx-auto mb-2"}),f.jsx("p",{className:"text-sm",children:"Vista previa de la imagen"})]})})})}),f.jsxs("button",{onClick:()=>{var e;return null==(e=d.current)?void 0:e.click()},className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",children:[f.jsx(T,{className:"h-4 w-4 mr-2"}),"Seleccionar imagen desde dispositivo"]}),f.jsx("input",{ref:d,type:"file",accept:"image/*",onChange:e=>{var r;const t=null==(r=e.target.files)?void 0:r[0];if(t){const e=new FileReader;e.onload=e=>{var r;const t=null==(r=e.target)?void 0:r.result;l(t),c(t)},e.readAsDataURL(t)}},className:"hidden"}),f.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Si no seleccionas una imagen, se usará una imagen por defecto"})]})]}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gray-50",children:[f.jsx("button",{onClick:m,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",children:"Cancelar"}),f.jsx("button",{onClick:()=>{if(!a.trim())return void alert("El nombre de la marca es requerido");if(!o.trim())return void alert("La imagen de la marca es requerida");const e=document.querySelector("[data-save-brand-button]");e&&(e.disabled=!0,e.textContent="Creando..."),s(a.trim(),o.trim()),setTimeout(()=>{u(),r()},100)},"data-save-brand-button":!0,disabled:!a.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Crear Marca"})]})]})}):null},he=({onBrandSelect:e})=>{const{brands:r,loading:s,error:a,createBrand:n,updateBrand:o,deleteBrand:l}=ce(),{hasPermission:i}=ie(),[c,d]=t.useState(null),[m,u]=t.useState(!1),[x,h]=t.useState(!1);if(s)return f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen",children:f.jsx("div",{className:"flex items-center justify-center py-16",children:f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"}),f.jsx("p",{className:"text-gray-600",children:"Cargando marcas..."})]})})});if(a)return f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen",children:f.jsx("div",{className:"flex items-center justify-center py-16",children:f.jsxs("div",{className:"text-center",children:[f.jsxs("p",{className:"text-red-600 mb-4",children:["Error al cargar las marcas: ",a]}),f.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200",children:"Reintentar"})]})})});const g=()=>{i("excel_formats","create")?alert("Importar Excel clicked"):alert("No tienes permisos para importar datos")},p=()=>{alert("Exportar Catálogo clicked")};return f.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen",children:[f.jsx("div",{className:"mb-8",children:f.jsxs("div",{className:"text-center mb-12",children:[f.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-red-600 to-red-700 bg-clip-text text-transparent mb-4",children:"Catálogo de Productos"}),f.jsx("p",{className:"text-xl text-gray-600 max-w-2xl mx-auto",children:"Selecciona una marca para explorar su catálogo completo y gestionar productos"})]})}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:r.map(t=>f.jsx(me,{brand:{id:t.id,name:t.name,image:t.image,description:t.description,isManagement:t.is_management},onEdit:i("brands","update")?()=>(e=>{if(i("brands","update")){const t=r.find(r=>r.id===e);t&&(d(t),u(!0))}else alert("No tienes permisos para editar marcas")})(t.id):void 0,onImport:g,onExport:p,onExplore:()=>{return r=t.name,void e(r);var r},onDelete:i("brands","delete")?()=>(async e=>{if(i("brands","delete")){if(confirm("¿Estás seguro de que deseas eliminar esta marca? Esta acción no se puede deshacer."))try{await l(e)}catch(r){alert("Error al eliminar la marca: "+(r instanceof Error?r.message:"Error desconocido"))}}else alert("No tienes permisos para eliminar marcas")})(t.id):void 0},t.id))}),c&&f.jsx(ue,{isOpen:m,onClose:()=>{u(!1),d(null)},brandName:c.name,brandImage:c.image,onSave:async(e,r)=>{if(c&&i("brands","update")){const s=document.createElement("div");s.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50",s.textContent="Marca actualizada exitosamente",document.body.appendChild(s),setTimeout(()=>{document.body.removeChild(s)},3e3);try{await o(c.id,{name:e,image:r})}catch(t){document.body.contains(s)&&document.body.removeChild(s),alert("Error al actualizar la marca: "+(t instanceof Error?t.message:"Error desconocido"))}}}}),x&&f.jsx(xe,{isOpen:x,onClose:()=>h(!1),onSave:async(e,r)=>{const t=document.createElement("div");t.className="fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50",t.textContent="Marca creada exitosamente",document.body.appendChild(t),setTimeout(()=>{document.body.removeChild(t)},3e3);try{await n({name:e,image:r,description:"Click para explorar catálogo",is_management:!1})}catch(s){document.body.contains(t)&&document.body.removeChild(t),alert("Error al crear la marca: "+(s instanceof Error?s.message:"Error desconocido"))}}})]})},ge=["#DC2626","#EA580C","#2563EB","#7C3AED","#059669","#374151"],pe=[{value:"text",label:"Texto"},{value:"number",label:"Número"},{value:"selection",label:"Selección"}],fe=({isOpen:e,onClose:r,brandName:s,onSave:a})=>{const[n,o]=t.useState(`Formato ${s}`),[l,i]=t.useState(`Formato personalizado para productos de ${s}`),[c,d]=t.useState(ge[0]),[m,u]=t.useState([{id:"1",internalName:"nombre",excelLabel:"NOMBRE",type:"text",required:!0},{id:"2",internalName:"precio",excelLabel:"PRECIO",type:"number",required:!0}]),x=(e,r)=>{u(m.map(t=>t.id===e?{...t,...r}:t))};return e?f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[60] p-4",children:f.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-5xl w-full max-h-[95vh] flex flex-col",children:[f.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center",children:f.jsx(U,{className:"h-6 w-6 text-red-600"})}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Crear Formato Personalizado"}),f.jsxs("p",{className:"text-sm text-gray-600",children:["Para ",s]})]})]}),f.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:f.jsx(K,{className:"h-6 w-6"})})]}),f.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nombre del Formato ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"text",value:n,onChange:e=>o(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Formato Stanley"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color del Formato"}),f.jsx("div",{className:"flex flex-wrap gap-2",children:ge.map(e=>f.jsx("button",{onClick:()=>d(e),className:"w-8 h-8 rounded-lg border-2 transition-all duration-200 "+(c===e?"border-gray-400 scale-110":"border-gray-200"),style:{backgroundColor:e}},e))})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripción"}),f.jsx("textarea",{value:l,onChange:e=>i(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500",placeholder:"Formato personalizado para productos de Stanley"})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Campos del Excel"}),f.jsxs("button",{onClick:()=>{const e={id:Date.now().toString(),internalName:"",excelLabel:"",type:"text",required:!1};u([...m,e])},className:"inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200",children:[f.jsx($,{className:"h-4 w-4 mr-1"}),"Agregar Campo"]})]}),f.jsx("div",{className:"space-y-4",children:m.map((e,r)=>{var t;return f.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-5 gap-3 items-start",children:[f.jsxs("div",{className:"flex items-center space-x-2 lg:col-span-1",children:[f.jsx(M,{className:"h-4 w-4 text-gray-400"}),f.jsxs("div",{className:"flex-1",children:[f.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Campo Interno ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"text",value:e.internalName,onChange:r=>x(e.id,{internalName:r.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500",placeholder:"nombre, precio, descripcion..."}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Campos sugeridos: nombre, descripcion, precio, unidad, departamento, codigo_barras, clave"})]})]}),f.jsxs("div",{className:"lg:col-span-1",children:[f.jsxs("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:["Etiqueta en Excel ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"text",value:e.excelLabel,onChange:r=>x(e.id,{excelLabel:r.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500",placeholder:"NOMBRE, PRECIO, DESCRIPCIÓN..."}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Como aparecerá en la primera fila del Excel"})]}),f.jsxs("div",{className:"lg:col-span-1",children:[f.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Tipo"}),f.jsx("select",{value:e.type,onChange:r=>x(e.id,{type:r.target.value}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500",children:pe.map(e=>f.jsx("option",{value:e.value,children:e.label},e.value))})]}),f.jsx("div",{className:"lg:col-span-1 flex items-center justify-center",children:f.jsxs("label",{className:"flex items-center space-x-1",children:[f.jsx("input",{type:"checkbox",checked:e.required,onChange:r=>x(e.id,{required:r.target.checked}),className:"w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500"}),f.jsx("span",{className:"text-xs font-medium text-gray-700",children:"Requerido"})]})}),f.jsx("div",{className:"lg:col-span-1 flex items-center justify-center",children:m.length>1&&f.jsx("button",{onClick:()=>{return r=e.id,void u(m.filter(e=>e.id!==r));var r},className:"p-1 text-red-600 hover:text-red-700 transition-colors duration-200",children:f.jsx(V,{className:"h-4 w-4"})})})]}),"selection"===e.type&&f.jsxs("div",{className:"mt-3",children:[f.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Opciones disponibles (separadas por coma)"}),f.jsx("input",{type:"text",value:(null==(t=e.options)?void 0:t.join(", "))||"",onChange:r=>x(e.id,{options:r.target.value.split(",").map(e=>e.trim()).filter(Boolean)}),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-red-500 focus:border-red-500",placeholder:"Pieza, Metro, Caja, Litro"})]})]},e.id)})})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Vista Previa del Formato Excel"}),f.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[f.jsx("div",{className:"bg-gray-50 px-4 py-2 border-b",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:c}}),f.jsx("span",{className:"font-medium text-gray-900",children:n})]})}),f.jsxs("div",{className:"p-4",children:[f.jsxs("div",{className:"mb-3",children:[f.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Encabezados del Excel:"}),f.jsx("div",{className:"flex flex-wrap gap-2",children:m.filter(e=>e.internalName&&e.excelLabel).map(e=>f.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:e.excelLabel},e.id))})]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:m.filter(e=>e.internalName&&e.excelLabel).map(e=>{var r;return f.jsxs("div",{className:"border border-gray-200 rounded p-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-1",children:[f.jsx("span",{className:"text-sm font-medium text-gray-900",children:e.excelLabel}),e.required&&f.jsx("span",{className:"text-xs text-red-600",children:"Requerido"})]}),f.jsxs("div",{className:"text-xs text-gray-600",children:["Tipo: ",null==(r=pe.find(r=>r.value===e.type))?void 0:r.label,"selection"===e.type&&e.options&&e.options.length>0&&f.jsxs("span",{className:"ml-2",children:["(",e.options.join(", "),")"]})]}),f.jsxs("div",{className:"text-xs text-gray-500",children:["Mapea a: ",e.internalName]})]},e.id)})})]})]})]})]})}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gray-50 flex-shrink-0",children:[f.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200",children:"Cancelar"}),f.jsx("button",{onClick:()=>{const e=m.filter(e=>e.internalName.trim()&&e.excelLabel.trim());n.trim()&&0!==e.length?a({name:n,description:l,color:c,fields:e}):alert("Por favor completa el nombre del formato y al menos un campo")},className:"px-4 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 transition-colors duration-200",children:"Crear Formato Excel"})]})]})}):null},be=r=>{const[t,s]=e.useState([]),[a,n]=e.useState(0),[o,l]=e.useState(!0),[i,c]=e.useState(null),d=e.useCallback(async()=>{try{if(l(!0),c(null),r){const e=ne.getProductsByBrand(r,1,1e3,"");s(e.products),n(e.total)}else s([]),n(0)}catch(e){c(e instanceof Error?e.message:"Error al cargar productos")}finally{l(!1)}},[r]),m=e.useCallback(async e=>{try{if(!r)throw new Error("Brand ID is required");const{customParameters:t,...s}=e,a={...s,brand_id:r,price:parseFloat(s.price)||0},n=ne.createProduct(a,t||[]);return await d(),n}catch(t){throw new Error(t instanceof Error?t.message:"Error al crear producto")}},[r,d]),u=e.useCallback(async e=>{try{const t=e.map(({product:e,parameters:t})=>({product:{...e,brand_id:r,price:parseFloat(e.price)||0},parameters:t||[]})),s=ne.createProductsBatch(t);return await d(),s}catch(t){throw new Error(t instanceof Error?t.message:"Error al crear productos en lote")}},[r,d]),x=e.useCallback(async(e,r)=>{try{const{customParameters:t,...s}=r,a=ne.updateProduct(e,{...s,price:parseFloat(s.price)||0},t||[]);if(a)return await d(),a;throw new Error("Producto no encontrado")}catch(t){throw new Error(t instanceof Error?t.message:"Error al actualizar producto")}},[d]),h=e.useCallback(async e=>{try{if(!ne.deleteProduct(e))throw new Error("Producto no encontrado");await d()}catch(r){throw new Error(r instanceof Error?r.message:"Error al eliminar producto")}},[d]),g=e.useCallback(async()=>{await d()},[d]);return e.useEffect(()=>{d()},[d]),{products:t,totalCount:a,loading:o,error:i,addProduct:m,createProductsBatch:u,updateProduct:x,deleteProduct:h,refreshProducts:g}};class ye{static async processDataInBatches(e,r=25,t){const s={success:0,errors:[]};for(let n=0;n<e.length;n+=r){const o=e.slice(n,n+r);try{await t(o);s.success+=o.length,n+r<e.length&&await new Promise(e=>setTimeout(e,150))}catch(a){const e=a instanceof Error?a.message:"Error desconocido";s.errors.push(`Lote ${Math.floor(n/r)+1}: ${e}`)}}return s}static async validateFile(e,r){return new Promise(t=>{if(!re.validateFileType(e,["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv","application/csv"]))return void t({isValid:!1,errors:["Tipo de archivo no válido. Solo se permiten archivos Excel (.xlsx, .xls) y CSV"],warnings:[]});if(!re.validateFileSize(e,10))return void t({isValid:!1,errors:["El archivo es demasiado grande. Tamaño máximo: 10MB"],warnings:[]});const s=new FileReader;s.onload=e=>{var s,o;try{if(!(null==(s=e.target)?void 0:s.result))return void t({isValid:!1,errors:["Error al leer el archivo"],warnings:[]});const l=new Uint8Array(null==(o=e.target)?void 0:o.result),i=a(l,{type:"array"});if(0===i.SheetNames.length)return void t({isValid:!1,errors:["El archivo Excel no contiene hojas de cálculo"],warnings:[]});let c=i.SheetNames[0];const d=["Datos","Plantilla","Data","Template"],m=i.SheetNames.find(e=>d.some(r=>e.toLowerCase().includes(r.toLowerCase())));m&&(c=m);const u=i.Sheets[c],x=n.sheet_to_json(u,{header:1,defval:null,blankrows:!1,raw:!1});if(0===x.length)return void t({isValid:!1,errors:["La hoja de cálculo está vacía"],warnings:[]});const h=this.validateData(x,r);t(h)}catch(l){t({isValid:!1,errors:[`Error al procesar el archivo: ${l instanceof Error?l.message:"Error desconocido"}`],warnings:[]})}},s.onerror=()=>{t({isValid:!1,errors:["Error al leer el archivo"],warnings:[]})},s.readAsArrayBuffer(e)})}static validateData(e,r){const t=[],s=[],a=e[0],n=e.slice(1).filter(e=>Array.isArray(e)&&e.some(e=>null!=e&&""!==e));if(0===n.length)return{isValid:!1,errors:["No se encontraron filas de datos válidas"],warnings:[]};n.length>5e3&&s.push(`Archivo grande detectado (${n.length} filas). El procesamiento puede tomar varios minutos.`),n.length>15e3&&s.push(`Archivo muy grande (${n.length} filas). Se recomienda dividir en archivos más pequeños para mejor rendimiento.`);const o=r.sort((e,r)=>e.excel_label.localeCompare(r.excel_label)).map(e=>e.excel_label),l=e=>(null==e?void 0:e.toString().trim().toLowerCase().replace(/\s+/g," "))||"",i=a.map(l),c=o.map(l),d=o.filter(e=>!i.includes(l(e))),m=a.filter(e=>e&&!c.includes(l(e)));if(d.length>0&&t.push(`Faltan las siguientes columnas: ${d.join(", ")}`),m.length>0&&s.push(`Columnas adicionales encontradas (serán ignoradas): ${m.join(", ")}`),0===t.length){let e=0,o=0;const i=100;if(n.forEach((s,n)=>{if(t.length>=i)return void o++;let c=!1;r.forEach(e=>{const r=a.findIndex(r=>l(r)===l(e.excel_label));if(-1===r)return;const o=s[r],i=n+2;if(e.required&&this.isEmpty(o)&&(t.push(`Fila ${i}: El campo "${e.excel_label}" es requerido`),c=!0),!this.isEmpty(o)){if("number"===e.type){const r=this.parseNumber(o);isNaN(r)&&(t.push(`Fila ${i}: "${e.excel_label}" debe ser un número válido (valor actual: "${o}")`),c=!0)}if("selection"===e.type&&e.options&&e.options.length>0){const r=String(o).trim();e.options.map(e=>e.toLowerCase().trim()).includes(r.toLowerCase())||(t.push(`Fila ${i}: "${e.excel_label}" debe ser una de las opciones válidas: ${e.options.join(", ")} (valor actual: "${o}")`),c=!0)}}}),c?o++:e++}),t.length>=i){const r=n.length-e-o;r>0&&t.push(`... y posiblemente más errores en las ${r} filas restantes. Se muestran solo los primeros ${i} errores.`)}const c=n.slice(0,Math.min(n.length,2e4)).map(e=>{const t={};return r.forEach(r=>{const s=a.findIndex(e=>l(e)===l(r.excel_label));if(-1!==s){let a=e[s];this.isEmpty(a)?a=null:"number"===r.type?a=this.parseNumber(a):"text"!==r.type&&"selection"!==r.type||(a=String(a).trim()),t[r.internal_name]=a}}),t});return{isValid:0===t.length,errors:t,warnings:s,data:c,summary:{totalRows:n.length,validRows:e,invalidRows:o}}}return{isValid:0===t.length,errors:t,warnings:s}}static isEmpty(e){return null==e||""===String(e).trim()}static parseNumber(e){if("number"==typeof e)return e;const r=String(e).replace(/[^\d.,-]/g,"").replace(",",".");return parseFloat(r)}static generateTemplate(e,r,t){const s=n.book_new(),a=re.sanitizeFileName(e),l=re.sanitizeFileName(t),i=r.sort((e,r)=>e.excel_label.localeCompare(r.excel_label)).map(e=>e.excel_label),c=[i],d=this.generateExampleRows(r,3);c.push(...d);const m=n.aoa_to_sheet(c),u=i.map(()=>({wch:20}));m["!cols"]=u,n.book_append_sheet(s,m,"Plantilla");const x=this.generateInstructions(e,r,t),h=n.aoa_to_sheet(x);h["!cols"]=[{wch:30},{wch:15},{wch:15},{wch:50}],n.book_append_sheet(s,h,"Instrucciones");o(s,`Plantilla_${a}_${l}.xlsx`)}static generateExampleRows(e,r){const t=[];for(let s=0;s<r;s++){const r=e.sort((e,r)=>e.excel_label.localeCompare(r.excel_label)).map(e=>this.generateExampleValue(e,s+1));t.push(r)}return t}static generateExampleValue(e,r){switch(e.internal_name.toLowerCase()){case"nombre":return`Producto Ejemplo ${r}`;case"descripcion":return`Descripción del producto ${r}`;case"precio":return(299.99+50*r).toString();case"departamento":return"Materiales para Construcción";case"unidad":return"Pieza";case"codigo_barras":case"barcode":return`123456789012${r}`;case"clave":case"key":return`A-${r}${r}${r}`;default:return"number"===e.type?(10*r).toString():"selection"===e.type&&e.options&&e.options.length>0?e.options[r%e.options.length]:`Ejemplo ${r}`}}static generateInstructions(e,r,t){const s=[[`INSTRUCCIONES PARA PLANTILLA: ${e}`],[`Marca: ${t}`],[""],["IMPORTANTE:"],["1. NO modifique los nombres de las columnas (primera fila)"],["2. Complete los datos a partir de la fila 2"],["3. Elimine las filas de ejemplo antes de importar"],["4. Campos marcados como requeridos son obligatorios"],["5. Respete los tipos de datos especificados"],[""],["CAMPOS CONFIGURADOS:"],["Columna Excel","Tipo","Requerido","Descripción/Opciones"]];return r.sort((e,r)=>e.excel_label.localeCompare(r.excel_label)).forEach(e=>{let r=`Mapea al campo: ${e.internal_name}`;"selection"===e.type&&e.options&&e.options.length>0?r=`Opciones válidas: ${e.options.join(", ")}`:"number"===e.type&&(r+=" (solo números)"),s.push([e.excel_label,"text"===e.type?"Texto":"number"===e.type?"Número":"Selección",e.required?"SÍ":"NO",r])}),s.push([""]),s.push(["CONSEJOS:"]),s.push(["• Use formato de número para precios (ej: 299.99)"]),s.push(["• Los códigos de barras deben ser únicos"]),s.push(["• Las claves de producto deben ser únicas"]),s.push(["• Revise la ortografía antes de importar"]),s}}const je=({isOpen:r,onClose:s,brandName:a,brandId:n,onImportComplete:o})=>{const{formats:l,loading:i,createFormat:c}=(r=>{const[t,s]=e.useState([]),[a,n]=e.useState(!0),[o,l]=e.useState(null),i=e.useCallback(async()=>{try{if(n(!0),l(null),r){const e=ne.getExcelFormatsByBrand(r);s(e)}else s([])}catch(e){l(e instanceof Error?e.message:"Error al cargar formatos")}finally{n(!1)}},[r]),c=e.useCallback(async(e,r=[])=>{try{const t=ne.createExcelFormat(e,r);return s(e=>[t,...e]),t}catch(t){throw new Error(t instanceof Error?t.message:"Error al crear formato")}},[]),d=e.useCallback(async(e,r,t=[])=>{try{return await i(),null}catch(s){throw new Error(s instanceof Error?s.message:"Error al actualizar formato")}},[i]),m=e.useCallback(async e=>{try{await i()}catch(r){throw new Error(r instanceof Error?r.message:"Error al eliminar formato")}},[i]);return e.useEffect(()=>{r&&i()},[r,i]),{formats:t,loading:a,error:o,createFormat:c,updateFormat:d,deleteFormat:m,refetch:i}})(n),{createProductsBatch:d}=be(n),[m,u]=t.useState(""),[x,h]=t.useState(null),[g,p]=t.useState(!1),[b,y]=t.useState(null),[j,w]=t.useState(!1),[k,E]=t.useState(!1),[P,_]=t.useState(0),[M,A]=t.useState(null),[O,L]=t.useState(""),D=t.useRef(null),z=l.find(e=>e.id===m),F=async(e,r)=>{const t=await ye.validateFile(e,r.fields);return{isValid:t.isValid,errors:t.errors,warnings:t.warnings,data:t.data}},B=(e,r)=>{var t;const s={brand_id:n,name:"",description:"",price:0,unit:"",department:"",barcode:"",key:"",image:""},a=[];if(null==(t=r.fields)||t.forEach(r=>{const t=e[r.internal_name];if(null!=t&&""!==t)switch(r.internal_name.toLowerCase()){case"nombre":case"name":s.name=String(t).trim();break;case"descripcion":case"description":s.description=String(t).trim();break;case"precio":case"price":s.price=parseFloat(t)||0;break;case"unidad":case"unit":s.unit=String(t).trim();break;case"departamento":case"department":s.department=String(t).trim();break;case"codigo_barras":case"barcode":s.barcode=String(t).trim();break;case"clave":case"key":s.key=String(t).trim();break;case"imagen":case"image":s.image=String(t).trim();break;default:a.push({name:r.excel_label,value:String(t).trim(),type:r.type||"text"})}}),s.name||(s.name=`Producto ${Date.now()}`),s.unit||(s.unit="Pieza"),s.department||(s.department="General"),s.barcode||(s.barcode=`${Date.now()}${Math.floor(1e3*Math.random())}`),!s.key){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=e[Math.floor(Math.random()*e.length)];s.key=`${r}-${Date.now().toString().slice(-6)}`}return{product:s,parameters:a}};return t.useEffect(()=>{x&&z&&(w(!0),F(x,z).then(e=>{y(e),w(!1)}))},[m,z]),r?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden",children:[f.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:f.jsx(I,{className:"h-6 w-6 text-green-600"})}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Importar desde Excel"}),f.jsxs("p",{className:"text-sm text-gray-600",children:["Configurado para ",a]})]})]}),f.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",disabled:k,children:f.jsx(K,{className:"h-6 w-6"})})]}),f.jsx("div",{className:"p-6",children:f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Formatos para ",a]}),f.jsxs("button",{onClick:()=>p(!0),disabled:k,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 transition-colors duration-200 disabled:opacity-50",children:[f.jsx($,{className:"h-4 w-4 mr-1"}),"Nuevo Formato"]})]}),f.jsx("div",{className:"border-2 border-dashed border-gray-200 rounded-lg p-6",children:i?f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-red-600 mx-auto mb-4"}),f.jsx("p",{className:"text-sm text-gray-600",children:"Cargando formatos..."})]}):0===l.length?f.jsxs("div",{className:"text-center",children:[f.jsx(I,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),f.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:["No hay formatos disponibles para ",a]}),f.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Crea un formato personalizado para esta marca"})]}):f.jsx("div",{className:"space-y-3",children:l.map(e=>{var r;return f.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors duration-200 ${m===e.id?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300"} ${k?"opacity-50 cursor-not-allowed":""}`,onClick:()=>!k&&u(e.id),children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:e.color}}),f.jsxs("div",{className:"flex-1",children:[f.jsx("h4",{className:"text-sm font-medium text-gray-900",children:e.name}),f.jsx("p",{className:"text-xs text-gray-600",children:e.description}),f.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[(null==(r=e.fields)?void 0:r.length)||0," campos configurados"]})]})]}),f.jsxs("button",{onClick:r=>{r.stopPropagation(),(e=>{e.fields&&0!==e.fields.length?ye.generateTemplate(e.name,e.fields,a):alert("Este formato no tiene campos configurados")})(e)},disabled:k,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 bg-blue-50 rounded hover:bg-blue-100 transition-colors duration-200 disabled:opacity-50",title:"Descargar plantilla",children:[f.jsx(S,{className:"h-3 w-3 mr-1"}),"Plantilla"]})]})},e.id)})})})]}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Subir archivo Excel"}),f.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Selecciona un archivo Excel que coincida con el formato elegido"}),f.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center mb-6",children:[f.jsx(T,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),x?f.jsxs("div",{className:"mb-4",children:[f.jsx("p",{className:"text-sm font-medium text-gray-900",children:x.name}),f.jsxs("p",{className:"text-xs text-gray-600",children:[(x.size/1024/1024).toFixed(2)," MB"]})]}):null,f.jsxs("button",{onClick:()=>{var e;return null==(e=D.current)?void 0:e.click()},disabled:k,className:"inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50",children:[f.jsx(T,{className:"h-4 w-4 mr-2"}),"Seleccionar Archivo"]}),f.jsx("input",{ref:D,type:"file",accept:".csv,.xlsx,.xls",onChange:async e=>{var r;const t=null==(r=e.target.files)?void 0:r[0];if(t&&(h(t),y(null),A(null),z)){w(!0);const e=await F(t,z);y(e),w(!1)}},className:"hidden",disabled:k}),f.jsx("p",{className:"text-xs text-gray-500 mt-4",children:"Formatos soportados: CSV, XLSX, XLS (máx. 10MB)"})]}),k&&f.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Importando productos..."}),f.jsxs("span",{className:"text-sm text-blue-600",children:[P,"%"]})]}),O&&f.jsx("div",{className:"text-xs text-blue-600 mb-2",children:O}),f.jsx("div",{className:"w-full bg-blue-200 rounded-full h-2",children:f.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${P}%`}})}),f.jsx("div",{className:"text-xs text-blue-500 mt-2",children:"Procesando en lotes de 25 productos para mejor rendimiento y estabilidad"})]}),M&&f.jsxs("div",{className:"mb-6 space-y-4",children:[f.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx(C,{className:"h-5 w-5 text-green-600"}),f.jsxs("div",{children:[f.jsx("h4",{className:"text-sm font-medium text-green-800",children:"Importación completada"}),f.jsxs("p",{className:"text-sm text-green-700",children:[M.success," producto",1!==M.success?"s":""," importado",1!==M.success?"s":""," exitosamente"]})]})]})}),M.errors.length>0&&f.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg max-h-40 overflow-y-auto",children:[f.jsxs("h5",{className:"text-sm font-medium text-red-800 mb-2",children:["Errores durante la importación (",M.errors.length,"):"]}),f.jsxs("ul",{className:"text-sm text-red-700 space-y-1",children:[M.errors.slice(0,10).map((e,r)=>f.jsxs("li",{className:"flex items-start space-x-2",children:[f.jsx("span",{className:"text-red-500 mt-0.5",children:"•"}),f.jsx("span",{children:e})]},r)),M.errors.length>10&&f.jsxs("li",{className:"text-red-600 font-medium",children:["... y ",M.errors.length-10," errores más"]})]})]})]}),j&&f.jsx("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"}),f.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Validando archivo..."})]})}),b&&!j&&!k&&f.jsxs("div",{className:"mb-6 space-y-4",children:[f.jsx("div",{className:"p-4 rounded-lg border "+(b.isValid?"bg-green-50 border-green-200":"bg-red-50 border-red-200"),children:f.jsxs("div",{className:"flex items-start space-x-3",children:[b.isValid?f.jsx(C,{className:"h-5 w-5 text-green-600 mt-0.5"}):f.jsx(v,{className:"h-5 w-5 text-red-600 mt-0.5"}),f.jsxs("div",{className:"flex-1",children:[f.jsx("h4",{className:"text-sm font-medium "+(b.isValid?"text-green-800":"text-red-800"),children:b.isValid?"Archivo válido":"Errores encontrados"}),b.isValid&&b.data&&f.jsxs("p",{className:"text-sm text-green-700 mt-1",children:[b.data.length," registro",1!==b.data.length?"s":""," listo",1!==b.data.length?"s":""," para importar"]})]})]})}),b.errors.length>0&&f.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg max-h-40 overflow-y-auto",children:[f.jsx("h5",{className:"text-sm font-medium text-red-800 mb-2",children:"Errores:"}),f.jsx("ul",{className:"text-sm text-red-700 space-y-1",children:b.errors.map((e,r)=>f.jsxs("li",{className:"flex items-start space-x-2",children:[f.jsx("span",{className:"text-red-500 mt-0.5",children:"•"}),f.jsx("span",{children:e})]},r))})]}),b.warnings.length>0&&f.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg max-h-32 overflow-y-auto",children:[f.jsx("h5",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Advertencias:"}),f.jsx("ul",{className:"text-sm text-yellow-700 space-y-1",children:b.warnings.map((e,r)=>f.jsxs("li",{className:"flex items-start space-x-2",children:[f.jsx("span",{className:"text-yellow-500 mt-0.5",children:"•"}),f.jsx("span",{children:e})]},r))})]})]}),!m&&f.jsx("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:f.jsxs("div",{className:"flex items-start space-x-3",children:[f.jsx(N,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),f.jsxs("div",{children:[f.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Formato requerido"}),f.jsxs("p",{className:"text-sm text-yellow-700 mt-1",children:["Selecciona un formato específico para ",a," antes de subir el archivo."]})]})]})})]})]})}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gray-50",children:[f.jsx("button",{onClick:s,disabled:k,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors duration-200 disabled:opacity-50",children:k?"Importando...":"Cancelar"}),f.jsx("button",{onClick:async()=>{if(!m||!x||!b)return;if(!b.isValid)return void alert("Por favor corrige los errores de validación antes de importar");if(!b.data||0===b.data.length)return void alert("No hay datos válidos para importar");if(b.data.length>1e3){if(!confirm(`Vas a importar ${b.data.length} productos. Esto puede tomar varios minutos. ¿Deseas continuar?`))return}E(!0),_(0),A(null),L("Preparando datos...");const e={success:0,errors:[]},r=b.data.length;L(`Procesando ${r} productos en lotes de 25...`);try{for(let s=0;s<b.data.length;s+=25){const a=b.data.slice(s,s+25),n=Math.floor(s/25)+1,o=Math.ceil(b.data.length/25);L(`Procesando lote ${n} de ${o} (${a.length} productos)...`);try{const t=a.map(e=>{const{product:r,parameters:t}=B(e,z);return{product:r,parameters:t}}),n=await d(t);e.success+=n.length,_(Math.round((s+a.length)/r*100)),await new Promise(e=>setTimeout(e,200))}catch(t){const r=t instanceof Error?t.message:"Error desconocido";e.errors.push(`Lote ${n}: ${r}`)}}if(A(e),L(""),e.success>0){const r=document.createElement("div");r.className="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50",r.innerHTML=`\n          <div class="flex items-center space-x-2">\n            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">\n              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>\n            </svg>\n            <span>¡${e.success} productos importados exitosamente!</span>\n          </div>\n        `,document.body.appendChild(r),setTimeout(()=>{document.body.contains(r)&&document.body.removeChild(r)},5e3),o&&o()}}catch(s){alert("Error durante la importación: "+(s instanceof Error?s.message:"Error desconocido"))}finally{E(!1),_(0),L("")}},disabled:!m||!x||!(null==b?void 0:b.isValid)||k,className:"px-6 py-2 text-sm font-medium text-white bg-red-600 border border-transparent rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 shadow-md hover:shadow-lg",children:k?`Procesando... ${P}%`:(null==b?void 0:b.data)?`Importar ${b.data.length} Registros`:"Importar Archivo"})]})]})}),g&&f.jsx(fe,{isOpen:g,onClose:()=>p(!1),brandName:a,onSave:async e=>{try{const{fields:r,...t}=e,s={...t,brand_id:n},a=r.map(e=>({internal_name:e.internalName,excel_label:e.excelLabel,type:e.type,required:e.required,options:e.options||[]}));await c(s,a),p(!1)}catch(r){alert("Error al crear el formato: "+(r instanceof Error?r.message:"Error desconocido"))}}})]}):null},ve=["Materiales para Construcción","Herramientas","Electricidad","Plomería","Pintura","Jardinería"],Ne=["Pieza","Metro","Rollo","Caja","Paquete","Litro","Kilogramo","Metro cuadrado"],we=({isOpen:e,onClose:r,brandName:s,onSave:a,editingProduct:n})=>{const[o,l]=t.useState(n||{name:"",department:"",brand:s,unit:"",description:"",price:"",barcode:"",key:"",image:""}),[i,c]=t.useState((null==n?void 0:n.image)||""),[d,m]=t.useState((null==n?void 0:n.customParameters)||[]),[u,x]=t.useState(!1),[h,g]=t.useState({name:"",type:"text",options:""}),p=t.useRef(null);t.useEffect(()=>{n?(l(n),c(n.image||""),m(n.customParameters||[])):(l({name:"",department:"",brand:s,unit:"",description:"",price:"",barcode:"",key:"",image:""}),c(""),m([]))},[n,s]);const b=(e,r)=>{l(t=>({...t,[e]:r}))},y=(e,r)=>{m(t=>t.map(t=>t.id===e?{...t,value:r}:t))};return e?f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:f.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[95vh] flex flex-col",children:[f.jsxs("div",{className:"relative bg-gradient-to-r from-red-600 to-red-700 text-white p-6 rounded-t-2xl",children:[f.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-white hover:text-gray-200 transition-colors duration-200",children:f.jsx(K,{className:"h-6 w-6"})}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold",children:n?"Editar Producto":"Agregar Producto"}),f.jsxs("p",{className:"text-red-100",children:["Para ",s]})]})]}),f.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[f.jsxs("div",{className:"md:col-span-2",children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Imagen del Producto"}),f.jsx("div",{className:"mb-4",children:f.jsx("div",{className:"w-full h-40 border-2 border-dashed border-gray-300 rounded-xl overflow-hidden bg-gradient-to-br from-gray-50 to-gray-100",children:i?f.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover"}):f.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:f.jsxs("div",{className:"text-center",children:[f.jsx(k,{className:"h-12 w-12 mx-auto mb-2"}),f.jsx("p",{className:"text-sm",children:"Vista previa de la imagen del producto"})]})})})}),f.jsxs("button",{type:"button",onClick:()=>{var e;return null==(e=p.current)?void 0:e.click()},className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-xl text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-all duration-200 shadow-sm hover:shadow-md",children:[f.jsx(T,{className:"h-4 w-4 mr-2"}),"Seleccionar imagen del producto"]}),f.jsx("input",{ref:p,type:"file",accept:"image/*",onChange:e=>{var r;const t=null==(r=e.target.files)?void 0:r[0];if(t){const e=new FileReader;e.onload=e=>{var r;const t=null==(r=e.target)?void 0:r.result;l(e=>({...e,image:t})),c(t)},e.readAsDataURL(t)}},className:"hidden"})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Nombre ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"text",value:o.name,onChange:e=>b("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"Amur"}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se formateará automáticamente en tipo oración"})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Departamento ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("select",{value:o.department,onChange:e=>b("department",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",children:[f.jsx("option",{value:"",children:"Seleccionar departamento"}),ve.map(e=>f.jsx("option",{value:e,children:e},e))]})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Marca ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("select",{value:o.brand,onChange:e=>b("brand",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",children:f.jsx("option",{value:s,children:s})}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Marca preseleccionada del catálogo actual"})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Unidad de Venta ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("select",{value:o.unit,onChange:e=>b("unit",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",children:[f.jsx("option",{value:"",children:"Seleccionar unidad"}),Ne.map(e=>f.jsx("option",{value:e,children:e},e))]})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Descripción"}),f.jsx("textarea",{value:o.description,onChange:e=>b("description",e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"AMUR - 30X30"})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[o.unit?`Precio (${o.unit})`:"Precio (MXN)"," ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"number",value:o.price,onChange:e=>b("price",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"241",step:"0.01",min:"0"})]}),f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Código de Barras ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsx("input",{type:"text",value:o.barcode,onChange:e=>b("barcode",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"1130977984836"}),f.jsxs("button",{type:"button",onClick:()=>{const e=crypto.randomUUID().replace(/-/g,"").substring(0,13);l(r=>({...r,barcode:e}))},className:"px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 transition-all duration-200 flex items-center space-x-2 shadow-md hover:shadow-lg",children:[f.jsx(R,{className:"h-4 w-4"}),f.jsx("span",{children:"Generar"})]})]}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Código de barras para escaneo en punto de venta"})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Clave ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsx("input",{type:"text",value:o.key,onChange:e=>b("key",e.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"A-61"}),f.jsxs("button",{type:"button",onClick:()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",r=e[Math.floor(26*Math.random())],t=crypto.randomUUID().replace(/-/g,"").substring(0,8);l(e=>({...e,key:`${r}-${t}`}))},className:"px-4 py-2 bg-gradient-to-r from-orange-600 to-orange-700 text-white rounded-lg hover:from-orange-700 hover:to-orange-800 transition-all duration-200 flex items-center space-x-2 shadow-md hover:shadow-lg",children:[f.jsx(Y,{className:"h-4 w-4"}),f.jsx("span",{children:"Auto"})]})]}),f.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Clave específica para productos"})]})]}),f.jsxs("div",{className:"border-t pt-6",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Parámetros Personalizados"}),f.jsxs("button",{type:"button",onClick:()=>x(!0),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-red-600 bg-red-50 rounded-lg hover:bg-red-100 transition-colors duration-200",children:[f.jsx($,{className:"h-4 w-4 mr-1"}),"Crear Parámetro"]})]}),u&&f.jsxs("div",{className:"bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-xl mb-4 border border-gray-200",children:[f.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre del Parámetro"}),f.jsx("input",{type:"text",value:h.name,onChange:e=>g(r=>({...r,name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"Color, Tamaño, Material..."})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),f.jsxs("select",{value:h.type,onChange:e=>g(r=>({...r,type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",children:[f.jsx("option",{value:"text",children:"Texto"}),f.jsx("option",{value:"number",children:"Número"}),f.jsx("option",{value:"select",children:"Selección"})]})]}),"select"===h.type&&f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Opciones (separadas por coma)"}),f.jsx("input",{type:"text",value:h.options,onChange:e=>g(r=>({...r,options:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"Rojo, Azul, Verde"})]})]}),f.jsxs("div",{className:"flex space-x-2",children:[f.jsx("button",{type:"button",onClick:()=>{if(!h.name.trim())return;const e={id:Date.now().toString(),name:h.name,value:"",type:h.type,options:"select"===h.type?h.options.split(",").map(e=>e.trim()).filter(Boolean):void 0};m(r=>[...r,e]),g({name:"",type:"text",options:""}),x(!1)},className:"px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg hover:from-red-700 hover:to-red-800 transition-all duration-200 shadow-md hover:shadow-lg",children:"Agregar Parámetro"}),f.jsx("button",{type:"button",onClick:()=>x(!1),className:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors duration-200",children:"Cancelar"})]})]}),d.length>0&&f.jsx("div",{className:"space-y-4",children:d.map(e=>{var r;return f.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl border border-gray-200",children:[f.jsxs("div",{className:"flex-1",children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:e.name}),"select"===e.type?f.jsxs("select",{value:e.value,onChange:r=>y(e.id,r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",children:[f.jsx("option",{value:"",children:"Seleccionar..."}),null==(r=e.options)?void 0:r.map(e=>f.jsx("option",{value:e,children:e},e))]}):f.jsx("input",{type:e.type,value:e.value,onChange:r=>y(e.id,r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200"})]}),f.jsx("button",{type:"button",onClick:()=>{return r=e.id,void m(e=>e.filter(e=>e.id!==r));var r},className:"p-2 text-red-600 hover:text-red-700 transition-colors duration-200",children:f.jsx(K,{className:"h-4 w-4"})})]},e.id)})})]})]})}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gradient-to-r from-gray-50 to-gray-100 flex-shrink-0 rounded-b-2xl",children:[f.jsx("button",{onClick:r,className:"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 transition-colors duration-200 shadow-sm hover:shadow-md",children:"Cancelar"}),f.jsx("button",{onClick:()=>{const{brand:e,...t}=o,s=document.querySelector("[data-save-button]");s&&(s.disabled=!0,s.textContent="Guardando...");const n={...t,customParameters:d};a(n),setTimeout(()=>{r()},100)},"data-save-button":!0,disabled:!(o.name&&o.department&&o.unit&&o.price),className:"px-6 py-2 text-sm font-medium text-white bg-gradient-to-r from-red-600 to-red-700 border border-transparent rounded-xl hover:from-red-700 hover:to-red-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg",children:n?"Actualizar Producto":"Guardar Producto"})]})]})}):null},ke=({product:e,onView:r,onEditImage:s,onEditName:a,onEditProduct:n,onDelete:o,isSelectionMode:l=!1,isSelected:i=!1,onToggleSelection:c})=>{var d,m,u;const[x,h]=t.useState(!1);return f.jsxs("div",{className:"group bg-white rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 overflow-hidden",children:[f.jsxs("div",{className:`relative aspect-square bg-gradient-to-br from-gray-50 to-gray-100 overflow-hidden cursor-pointer ${l?"select-none":""} ${i?"ring-4 ring-red-500 ring-opacity-50":""}`,onClick:()=>r(e),children:[l&&f.jsx("div",{className:"absolute top-3 left-3 z-20",children:f.jsx("input",{type:"checkbox",checked:i,onChange:r=>{r.stopPropagation(),null==c||c(e.id)},className:"w-5 h-5 text-red-600 border-2 border-white rounded focus:ring-red-500 shadow-lg"})}),l&&f.jsx("div",{className:"absolute top-3 left-3 z-20",children:f.jsx("input",{type:"checkbox",checked:i,onChange:r=>{r.stopPropagation(),null==c||c(e.id)},className:"w-5 h-5 text-red-600 border-2 border-white rounded focus:ring-red-500 shadow-lg"})}),e.image?f.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}):f.jsx("div",{className:"w-full h-full flex items-center justify-center",children:f.jsx(z,{className:"h-16 w-16 text-gray-300"})}),f.jsx("div",{className:"absolute top-3 left-3",children:f.jsx("span",{className:"bg-red-600 text-white text-xs font-medium px-2 py-1 rounded-full",children:(null==(d=e.brand)?void 0:d.name)||"Marca Desconocida"})}),!l&&f.jsxs("div",{className:"absolute top-3 right-3 z-10",children:[f.jsx("button",{onClick:e=>{e.stopPropagation(),h(!x)},className:"w-8 h-8 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white hover:bg-white/30 transition-all duration-200 shadow-lg",children:f.jsx(D,{className:"h-4 w-4"})}),x&&f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>h(!1)}),f.jsxs("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-xl shadow-2xl py-3 z-20 border border-gray-200",children:[n&&f.jsxs("button",{onClick:r=>{r.stopPropagation(),h(!1),n(e)},className:"flex items-center space-x-3 px-5 py-3 text-base font-medium text-gray-700 hover:bg-red-50 hover:text-red-600 w-full text-left transition-colors duration-200",children:[f.jsx(R,{className:"h-5 w-5"}),f.jsx("span",{children:"Editar Producto"})]}),f.jsxs("button",{onClick:r=>{r.stopPropagation(),h(!1),null==s||s(e)},className:"flex items-center space-x-3 px-5 py-3 text-base font-medium text-gray-700 hover:bg-red-50 hover:text-red-600 w-full text-left transition-colors duration-200",children:[f.jsx(k,{className:"h-5 w-5"}),f.jsx("span",{children:"Editar Foto"})]}),f.jsxs("button",{onClick:r=>{r.stopPropagation(),h(!1),null==a||a(e)},className:"flex items-center space-x-3 px-5 py-3 text-base font-medium text-gray-700 hover:bg-red-50 hover:text-red-600 w-full text-left transition-colors duration-200",children:[f.jsx(U,{className:"h-5 w-5"}),f.jsx("span",{children:"Cambiar Nombre"})]}),f.jsx("div",{className:"border-t border-gray-200 my-3"}),o&&f.jsxs("button",{onClick:r=>{r.stopPropagation(),h(!1),o(e)},className:"flex items-center space-x-3 px-5 py-3 text-base font-medium text-red-600 hover:bg-red-50 w-full text-left transition-colors duration-200",children:[f.jsx(V,{className:"h-5 w-5"}),f.jsx("span",{children:"Borrar Producto"})]})]})]})]})]}),f.jsxs("div",{className:"p-6",children:[f.jsx("div",{className:"mb-3",children:f.jsxs("p",{className:"text-base text-gray-700 leading-relaxed font-medium",children:['Descripción: "',e.description||e.name,'"']})}),f.jsx("div",{className:"mb-3",children:f.jsxs("p",{className:"text-base text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Precio: "}),f.jsxs("span",{className:"font-bold text-red-600 text-lg",children:["$",e.price,"/ ",e.unit]})]})}),f.jsx("div",{className:"mb-3",children:f.jsxs("p",{className:"text-base text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Clave: "}),f.jsx("span",{className:"font-bold text-gray-900 text-lg",children:e.key})]})}),f.jsx("div",{className:"mb-3",children:f.jsxs("p",{className:"text-base text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Código de barras: "}),f.jsx("span",{className:"font-mono text-gray-900 text-sm",children:e.barcode})]})}),(null==(m=e.customParameters)?void 0:m.filter(e=>e.value&&e.value.trim()).length)>0&&f.jsx("div",{className:"mb-3 space-y-1",children:null==(u=e.customParameters)?void 0:u.filter(e=>e.value&&e.value.trim()).map(e=>f.jsx("div",{className:"mb-1",children:f.jsxs("p",{className:"text-base text-gray-700",children:[f.jsxs("span",{className:"font-medium",children:[e.name,": "]}),f.jsx("span",{className:"text-gray-900",children:e.value})]})},e.id))})]})]})},Ce=({isOpen:e,onClose:r,product:t})=>{var s,a;return e?f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:f.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-7xl w-full h-[95vh] flex flex-col overflow-hidden",children:[f.jsxs("div",{className:"relative bg-gradient-to-r from-red-600 to-red-700 text-white p-6 flex-shrink-0",children:[f.jsx("button",{onClick:r,className:"absolute top-4 right-4 text-white hover:text-gray-200 transition-colors duration-200",children:f.jsx(K,{className:"h-6 w-6"})}),f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:f.jsx(z,{className:"h-6 w-6"})}),f.jsxs("div",{children:[f.jsx("h1",{className:"text-2xl font-bold",children:t.name}),f.jsx("p",{className:"text-red-100",children:"Detalles del Producto"})]})]})]}),f.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[f.jsx("div",{className:"w-1/2 p-6 bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center",children:f.jsx("div",{className:"w-full max-w-lg aspect-square bg-white rounded-xl shadow-inner overflow-hidden",children:t.image?f.jsx("img",{src:t.image,alt:t.name,className:"w-full h-full object-cover"}):f.jsx("div",{className:"w-full h-full flex items-center justify-center",children:f.jsxs("div",{className:"text-center",children:[f.jsx(z,{className:"h-32 w-32 text-gray-300 mx-auto mb-6"}),f.jsx("p",{className:"text-xl text-gray-500",children:"Sin imagen disponible"})]})})})}),f.jsx("div",{className:"w-1/2 p-6 flex flex-col justify-start overflow-y-auto",children:f.jsxs("div",{className:"space-y-6",children:[f.jsx("div",{children:f.jsxs("p",{className:"text-xl text-gray-700 leading-relaxed font-medium",children:['Descripción: "',t.description||t.name,'"']})}),f.jsx("div",{children:f.jsxs("p",{className:"text-xl text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Precio: "}),f.jsxs("span",{className:"font-bold text-red-600 text-2xl",children:["$",t.price,"/ ",t.unit]})]})}),f.jsx("div",{children:f.jsxs("p",{className:"text-xl text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Clave: "}),f.jsx("span",{className:"font-bold text-gray-900 text-2xl",children:t.key})]})}),f.jsx("div",{children:f.jsxs("p",{className:"text-xl text-gray-700",children:[f.jsx("span",{className:"font-medium",children:"Código de barras: "}),f.jsx("span",{className:"font-mono text-gray-900 text-lg",children:t.barcode})]})}),(null==(s=t.customParameters)?void 0:s.filter(e=>e.value&&e.value.trim()).length)>0&&f.jsx("div",{className:"space-y-3",children:null==(a=t.customParameters)?void 0:a.filter(e=>e.value&&e.value.trim()).map(e=>f.jsx("div",{children:f.jsxs("p",{className:"text-xl text-gray-700",children:[f.jsxs("span",{className:"font-medium",children:[e.name,": "]}),f.jsx("span",{className:"text-gray-900",children:e.value})]})},e.id))})]})})]})]})}):null},Se=({isOpen:e,onClose:r,product:s,onSave:a})=>{const[n,o]=t.useState(s.image||""),[l,i]=t.useState(s.image||""),c=t.useRef(null);t.useEffect(()=>{o(s.image||""),i(s.image||"")},[s.image]);const d=()=>{o(s.image||""),i(s.image||""),r()};return e?f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4",children:[f.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Editar Imagen"}),f.jsx("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:f.jsx(K,{className:"h-6 w-6"})})]}),f.jsxs("div",{className:"p-6 space-y-6",children:[f.jsxs("div",{children:[f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:s.name}),f.jsx("p",{className:"text-sm text-gray-600",children:"Actualiza la imagen de este producto"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nueva Imagen"}),f.jsx("div",{className:"mb-4",children:f.jsx("div",{className:"w-full h-48 border-2 border-dashed border-gray-300 rounded-xl overflow-hidden bg-gradient-to-br from-gray-50 to-gray-100",children:l?f.jsx("img",{src:l,alt:"Preview",className:"w-full h-full object-cover"}):f.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:f.jsxs("div",{className:"text-center",children:[f.jsx(k,{className:"h-12 w-12 mx-auto mb-2"}),f.jsx("p",{className:"text-sm",children:"Vista previa de la imagen"})]})})})}),f.jsxs("button",{onClick:()=>{var e;return null==(e=c.current)?void 0:e.click()},className:"w-full flex items-center justify-center px-4 py-3 border border-gray-300 rounded-xl text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200 shadow-sm hover:shadow-md",children:[f.jsx(T,{className:"h-4 w-4 mr-2"}),"Seleccionar nueva imagen"]}),f.jsx("input",{ref:c,type:"file",accept:"image/*",onChange:e=>{var r;const t=null==(r=e.target.files)?void 0:r[0];if(t){const e=new FileReader;e.onload=e=>{var r;const t=null==(r=e.target)?void 0:r.result;o(t),i(t)},e.readAsDataURL(t)}},className:"hidden"})]})]}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gray-50 rounded-b-xl",children:[f.jsx("button",{onClick:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",children:"Cancelar"}),f.jsx("button",{onClick:()=>{a(s.id,n)},className:"px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-red-600 to-red-700 border border-transparent rounded-lg hover:from-red-700 hover:to-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200 shadow-md hover:shadow-lg",children:"Guardar Cambios"})]})]})}):null},Ee=({isOpen:e,onClose:r,product:s,onSave:a})=>{const[n,o]=t.useState(s.name);t.useEffect(()=>{o(s.name)},[s.name]);const l=()=>{o(s.name),r()};return e?f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-md w-full mx-4",children:[f.jsxs("div",{className:"flex items-center justify-between p-6 border-b",children:[f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:f.jsx(U,{className:"h-5 w-5 text-red-600"})}),f.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Cambiar Nombre"})]}),f.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600 transition-colors duration-200",children:f.jsx(K,{className:"h-6 w-6"})})]}),f.jsxs("div",{className:"p-6 space-y-6",children:[f.jsxs("div",{children:[f.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre Actual"}),f.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:f.jsx("p",{className:"text-gray-900 font-medium",children:s.name})})]}),f.jsxs("div",{children:[f.jsxs("label",{htmlFor:"productName",className:"block text-sm font-medium text-gray-700 mb-2",children:["Nuevo Nombre ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsx("input",{type:"text",id:"productName",value:n,onChange:e=>o(e.target.value),className:"w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"Ingresa el nuevo nombre del producto"}),f.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"El nombre se formateará automáticamente en tipo oración"})]})]}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t bg-gray-50 rounded-b-xl",children:[f.jsx("button",{onClick:l,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition-colors duration-200",children:"Cancelar"}),f.jsx("button",{onClick:()=>{n.trim()?a(s.id,n.trim()):alert("Por favor ingresa un nombre válido")},disabled:!n.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-red-600 to-red-700 border border-transparent rounded-lg hover:from-red-700 hover:to-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200 shadow-md hover:shadow-lg",children:"Guardar Cambios"})]})]})}):null},Pe=({brandName:r,brandId:t,onBack:s})=>{ie();const{brands:a}=ce(),n=a.find(e=>e.name===r),{products:o,addProduct:l,updateProduct:i,deleteProduct:c,refreshProducts:d}=be(null==n?void 0:n.id),[m,u]=e.useState(!1),[x,h]=e.useState(!1),[g,p]=e.useState(null),[b,y]=e.useState(!1),[j,v]=e.useState(!1),[N,k]=e.useState(!1),[C,S]=e.useState(""),[E,P]=e.useState("all"),I=o.filter(e=>{var r;const t=e.name.toLowerCase().includes(C.toLowerCase())||(null==(r=e.description)?void 0:r.toLowerCase().includes(C.toLowerCase())),s="all"===E||e.department===E;return t&&s}),M=[...new Set(o.map(e=>e.department).filter(Boolean))],A=e=>{p(e),h(!0)},O=async e=>{if(window.confirm("¿Estás seguro de que deseas eliminar este producto?"))try{await c(e.id)}catch(r){alert("Error al eliminar el producto: "+(r instanceof Error?r.message:"Error desconocido"))}},L=e=>{p(e),y(!0)},D=e=>{p(e),v(!0)},R=e=>{p(e),k(!0)};return f.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[f.jsx("div",{className:"bg-white shadow-sm border-b",children:f.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:f.jsxs("div",{className:"flex items-center justify-between h-16",children:[f.jsxs("div",{className:"flex items-center space-x-4",children:[f.jsxs("button",{onClick:s,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors",children:[f.jsx(w,{className:"w-5 h-5"}),f.jsx("span",{children:"Back to Brands"})]}),f.jsx("div",{className:"h-6 w-px bg-gray-300"}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(z,{className:"w-6 h-6 text-blue-600"}),f.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:r})]})]}),f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsxs("button",{onClick:()=>d(),className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[f.jsx(F,{className:"w-4 h-4"}),f.jsx("span",{children:"Refresh"})]}),f.jsxs("button",{onClick:()=>u(!0),className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[f.jsx(T,{className:"w-4 h-4"}),f.jsx("span",{children:"Import Excel"})]}),f.jsxs("button",{onClick:()=>{p(null),h(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[f.jsx($,{className:"w-4 h-4"}),f.jsx("span",{children:"Add Product"})]})]})]})})}),f.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[f.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:f.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[f.jsx("div",{className:"flex-1",children:f.jsxs("div",{className:"relative",children:[f.jsx(B,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),f.jsx("input",{type:"text",placeholder:"Search products...",value:C,onChange:e=>S(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),f.jsxs("div",{className:"flex items-center space-x-2",children:[f.jsx(_,{className:"w-5 h-5 text-gray-400"}),f.jsxs("select",{value:E,onChange:e=>P(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[f.jsx("option",{value:"all",children:"All Categories"}),M.map(e=>f.jsx("option",{value:e,children:e},e))]})]})]})}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:I.map(e=>f.jsx(ke,{product:e,onView:L,onEditImage:D,onEditName:R,onEditProduct:A,onDelete:O},e.id))}),0===I.length&&f.jsxs("div",{className:"text-center py-12",children:[f.jsx(z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),f.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No products found"}),f.jsx("p",{className:"text-gray-500 mb-6",children:C||"all"!==E?"Try adjusting your search or filter criteria":"Get started by adding your first product or importing from Excel"}),!C&&"all"===E&&f.jsxs("div",{className:"flex justify-center space-x-4",children:[f.jsxs("button",{onClick:()=>u(!0),className:"flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[f.jsx(T,{className:"w-4 h-4"}),f.jsx("span",{children:"Import Excel"})]}),f.jsxs("button",{onClick:()=>{p(null),h(!0)},className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[f.jsx($,{className:"w-4 h-4"}),f.jsx("span",{children:"Add Product"})]})]})]})]}),m&&n&&f.jsx(je,{isOpen:m,onClose:()=>u(!1),brandName:r,brandId:n.id,onImportComplete:()=>{u(!1),d()}}),x&&f.jsx(we,{isOpen:x,onClose:()=>{h(!1),p(null)},brandName:r,onSave:async e=>{try{g?await i(g.id,e):await l(e),h(!1),p(null)}catch(r){alert("Error al guardar el producto: "+(r instanceof Error?r.message:"Error desconocido"))}},editingProduct:g}),b&&g&&f.jsx(Ce,{isOpen:b,onClose:()=>{y(!1),p(null)},product:g}),j&&g&&f.jsx(Se,{isOpen:j,onClose:()=>{v(!1),p(null)},product:g,onSave:async(e,r)=>{try{await i(e,{image:r}),v(!1),p(null)}catch(t){alert("Error al actualizar la imagen: "+(t instanceof Error?t.message:"Error desconocido"))}}}),N&&g&&f.jsx(Ee,{isOpen:N,onClose:()=>{k(!1),p(null)},product:g,onSave:async(e,r)=>{try{await i(e,{name:r}),k(!1),p(null)}catch(t){alert("Error al actualizar el nombre: "+(t instanceof Error?t.message:"Error desconocido"))}}})]})},Ie=()=>{const[r,t]=e.useState("admin@sistema.com"),[s,a]=e.useState(""),[n,o]=e.useState(!1),[l,i]=e.useState(null),[c,d]=e.useState(!1);return f.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-red-50 flex items-center justify-center p-4",children:f.jsxs("div",{className:"w-full max-w-md",children:[f.jsxs("div",{className:"text-center mb-8",children:[f.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-red-600 to-red-700 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-xl",children:f.jsx("img",{src:"/logo.jpg",alt:"Logo",className:"w-16 h-16 object-contain rounded-xl"})}),f.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-red-600 to-red-700 bg-clip-text text-transparent",children:"Sistema de Gestión"}),f.jsx("p",{className:"text-gray-600 mt-2",children:"Catálogo de Productos Interceramic"}),f.jsxs("div",{className:"flex items-center justify-center mt-4 space-x-2 text-sm text-green-600",children:[f.jsx(q,{className:"w-4 h-4"}),f.jsx("span",{children:"Sistema Seguro Local"})]})]}),f.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 border border-gray-100",children:[f.jsxs("div",{className:"text-center mb-6",children:[f.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:"Iniciar Sesión"}),f.jsx("p",{className:"text-gray-600 mt-1",children:"Acceso seguro al sistema"})]}),f.jsxs("form",{onSubmit:async e=>{e.preventDefault(),o(!0),i(null);try{await le.signIn(r,s),window.location.reload()}catch(t){i(t.message||"Error de autenticación")}finally{o(!1)}},className:"space-y-6",children:[l&&f.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700",children:[f.jsx(v,{className:"w-5 h-5 flex-shrink-0"}),f.jsx("span",{className:"text-sm font-medium",children:l})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),f.jsxs("div",{className:"relative",children:[f.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),f.jsx("input",{id:"email",type:"email",value:r,onChange:e=>t(e.target.value),className:"w-full pl-11 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"admin@sistema.com",required:!0,autoComplete:"email"})]})]}),f.jsxs("div",{children:[f.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Contraseña"}),f.jsxs("div",{className:"relative",children:[f.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),f.jsx("input",{id:"password",type:c?"text":"password",value:s,onChange:e=>a(e.target.value),className:"w-full pl-11 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200 bg-gray-50 focus:bg-white",placeholder:"Ingresa tu contraseña",required:!0,autoComplete:"current-password"}),f.jsx("button",{type:"button",onClick:()=>d(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:c?f.jsx(E,{className:"w-5 h-5"}):f.jsx(P,{className:"w-5 h-5"})})]})]}),f.jsx("button",{type:"submit",disabled:n,className:"w-full bg-gradient-to-r from-red-600 to-red-700 text-white py-3 px-4 rounded-xl hover:from-red-700 hover:to-red-800 focus:ring-2 focus:ring-red-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-lg hover:shadow-xl font-medium",children:n?f.jsxs("div",{className:"flex items-center justify-center",children:[f.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Iniciando sesión..."]}):"Iniciar Sesión"})]}),f.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:f.jsxs("div",{className:"bg-blue-50 rounded-xl p-4",children:[f.jsx("h3",{className:"text-sm font-medium text-blue-900 mb-2",children:"Credenciales de Acceso"}),f.jsxs("div",{className:"space-y-1 text-xs text-blue-700",children:[f.jsxs("p",{children:[f.jsx("strong",{children:"Email:"})," admin@sistema.com"]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Contraseña:"})," Contacta al administrador"]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Rol:"})," Administrador"]})]})]})}),f.jsxs("div",{className:"mt-4 p-3 bg-green-50 rounded-xl",children:[f.jsx("h4",{className:"text-sm font-medium text-green-900 mb-2",children:"Características de Seguridad"}),f.jsxs("ul",{className:"text-xs text-green-700 space-y-1",children:[f.jsx("li",{children:"• Encriptación AES-256 de datos"}),f.jsx("li",{children:"• Protección contra ataques de fuerza bruta"}),f.jsx("li",{children:"• Sesiones seguras con tokens"}),f.jsx("li",{children:"• Validación de entrada sanitizada"})]})]}),f.jsxs("div",{className:"mt-8 pt-6 border-t border-gray-200 text-center",children:[f.jsx("p",{className:"text-xs text-gray-500",children:"Sistema de Gestión de Catálogo de Productos"}),f.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"© 2024 Interceramic. Todos los derechos reservados."})]})]})]})})},_e=({isOpen:r,onClose:t})=>{const[s,a]=e.useState({username:"",email:"",password:"",confirmPassword:"",role:"viewer"}),[n,o]=e.useState(!1),[l,i]=e.useState(null),[c,d]=e.useState(null),[m,u]=e.useState(!1),[x,h]=e.useState(!1),[g,p]=e.useState({valid:!1,errors:[]});if(!r)return null;const b=(e,r)=>{if(a(t=>({...t,[e]:r})),i(null),d(null),"password"===e){const e=re.validatePassword(r);p(e)}},y=()=>{a({username:"",email:"",password:"",confirmPassword:"",role:"viewer"}),p({valid:!1,errors:[]}),i(null),d(null),t()};return f.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:f.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[f.jsxs("div",{className:"relative bg-gradient-to-r from-red-600 to-red-700 text-white p-6 rounded-t-2xl",children:[f.jsx("button",{onClick:y,className:"absolute top-4 right-4 text-white hover:text-gray-200 transition-colors duration-200",children:f.jsx(K,{className:"h-6 w-6"})}),f.jsxs("div",{className:"flex items-center space-x-3",children:[f.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-lg flex items-center justify-center",children:f.jsx(G,{className:"h-6 w-6"})}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-2xl font-bold",children:"Crear Usuario"}),f.jsxs("p",{className:"text-red-100 flex items-center",children:[f.jsx(q,{className:"w-4 h-4 mr-1"}),"Sistema seguro local"]})]})]})]}),f.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),s.username.trim()?s.email.trim()?re.validateEmail(s.email)?g.valid?s.password===s.confirmPassword||(i("Las contraseñas no coinciden"),0):(i("La contraseña no cumple con los requisitos de seguridad"),0):(i("Ingresa un email válido"),0):(i("El email es requerido"),0):(i("El nombre de usuario es requerido"),0)){o(!0),i(null),d(null);try{await le.signUp(s.email,s.password,s.username,s.role),d("Usuario creado exitosamente"),setTimeout(()=>{a({username:"",email:"",password:"",confirmPassword:"",role:"viewer"}),p({valid:!1,errors:[]}),d(null),t()},2e3)}catch(r){i(r.message||"Error al crear el usuario. Verifica que el email no esté en uso.")}finally{o(!1)}}},className:"p-6 space-y-4",children:[l&&f.jsxs("div",{className:"flex items-center gap-3 p-4 bg-red-50 border border-red-200 rounded-xl text-red-700",children:[f.jsx(v,{className:"w-5 h-5 flex-shrink-0"}),f.jsx("span",{className:"text-sm font-medium",children:l})]}),c&&f.jsxs("div",{className:"flex items-center gap-3 p-4 bg-green-50 border border-green-200 rounded-xl text-green-700",children:[f.jsx(C,{className:"w-5 h-5 flex-shrink-0"}),f.jsx("span",{className:"text-sm font-medium",children:c})]}),f.jsxs("div",{children:[f.jsxs("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700 mb-2",children:["Nombre de Usuario ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("div",{className:"relative",children:[f.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),f.jsx("input",{id:"username",type:"text",value:s.username,onChange:e=>b("username",e.target.value),className:"w-full pl-11 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"usuario123",required:!0})]})]}),f.jsxs("div",{children:[f.jsxs("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:["Email ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("div",{className:"relative",children:[f.jsx(L,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),f.jsx("input",{id:"email",type:"email",value:s.email,onChange:e=>b("email",e.target.value),className:"w-full pl-11 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"usuario@empresa.com",required:!0})]})]}),f.jsxs("div",{children:[f.jsxs("label",{htmlFor:"role",className:"block text-sm font-medium text-gray-700 mb-2",children:["Rol ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("select",{id:"role",value:s.role,onChange:e=>b("role",e.target.value),className:"w-full px-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",required:!0,children:[f.jsx("option",{value:"viewer",children:"Visualizador (Solo lectura)"}),f.jsx("option",{value:"manager",children:"Gerente (Gestión de productos)"}),f.jsx("option",{value:"admin",children:"Administrador (Acceso completo)"})]})]}),f.jsxs("div",{children:[f.jsxs("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:["Contraseña ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("div",{className:"relative",children:[f.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),f.jsx("input",{id:"password",type:m?"text":"password",value:s.password,onChange:e=>b("password",e.target.value),className:"w-full pl-11 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"Contraseña segura",required:!0}),f.jsx("button",{type:"button",onClick:()=>u(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:m?f.jsx(E,{className:"w-5 h-5"}):f.jsx(P,{className:"w-5 h-5"})})]}),s.password&&f.jsxs("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg",children:[f.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Requisitos de contraseña:"}),f.jsxs("ul",{className:"text-xs space-y-1",children:[g.errors.map((e,r)=>f.jsxs("li",{className:"flex items-center text-red-600",children:[f.jsx(K,{className:"w-3 h-3 mr-1"}),e]},r)),g.valid&&f.jsxs("li",{className:"flex items-center text-green-600",children:[f.jsx(C,{className:"w-3 h-3 mr-1"}),"Contraseña segura"]})]})]})]}),f.jsxs("div",{children:[f.jsxs("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:["Confirmar Contraseña ",f.jsx("span",{className:"text-red-500",children:"*"})]}),f.jsxs("div",{className:"relative",children:[f.jsx(A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),f.jsx("input",{id:"confirmPassword",type:x?"text":"password",value:s.confirmPassword,onChange:e=>b("confirmPassword",e.target.value),className:"w-full pl-11 pr-12 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-all duration-200",placeholder:"Repite la contraseña",required:!0}),f.jsx("button",{type:"button",onClick:()=>h(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:x?f.jsx(E,{className:"w-5 h-5"}):f.jsx(P,{className:"w-5 h-5"})})]})]}),f.jsxs("div",{className:"p-3 bg-green-50 rounded-xl",children:[f.jsxs("h4",{className:"text-sm font-medium text-green-900 mb-2 flex items-center",children:[f.jsx(q,{className:"w-4 h-4 mr-1"}),"Características de Seguridad"]}),f.jsxs("ul",{className:"text-xs text-green-700 space-y-1",children:[f.jsx("li",{children:"• Encriptación AES-256 de datos"}),f.jsx("li",{children:"• Validación de contraseñas robusta"}),f.jsx("li",{children:"• Protección contra ataques"}),f.jsx("li",{children:"• Sesiones seguras"})]})]}),f.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-6 border-t border-gray-200",children:[f.jsx("button",{type:"button",onClick:y,className:"px-6 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-xl hover:bg-gray-50 transition-colors duration-200",children:"Cancelar"}),f.jsx("button",{type:"submit",disabled:n||!g.valid,className:"px-6 py-2 text-sm font-medium text-white bg-gradient-to-r from-red-600 to-red-700 border border-transparent rounded-xl hover:from-red-700 hover:to-red-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-md hover:shadow-lg",children:n?f.jsxs("div",{className:"flex items-center",children:[f.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Creando..."]}):"Crear Usuario"})]})]})]})})};function Me(){const[e,r]=t.useState("catalog"),[s,a]=t.useState(""),[n,o]=t.useState(""),[l,i]=t.useState(!1),[c,d]=t.useState(!1),{createBrand:m}=ce(),{user:u,loading:x}=ie();return x?f.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center",children:f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto mb-4"}),f.jsx("p",{className:"text-gray-600",children:"Cargando..."})]})}):u?f.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100",children:[f.jsx(de,{onNewBrand:()=>{i(!0)},onCreateUser:()=>d(!0)}),"catalog"===e?f.jsx(he,{onBrandSelect:e=>{a(e),r("brand")}}):f.jsx(Pe,{brandName:s,brandId:n,onBack:()=>{r("catalog"),a(""),o("")}}),l&&f.jsx(xe,{isOpen:l,onClose:()=>i(!1),onSave:async(e,r)=>{try{await m({name:e.trim(),image:r.trim(),description:"Click para explorar catálogo",is_management:!1}),i(!1)}catch(t){const e=t instanceof Error?t.message:"Error desconocido";alert(e)}}}),f.jsx(_e,{isOpen:c,onClose:()=>d(!1)})]}):f.jsx(Ie,{})}!function(){const e=re.getInstance();window.securityCleanupInterval||(window.securityCleanupInterval=setInterval(()=>{e.cleanupOldAttempts()},3e5))}(),p(document.getElementById("root")).render(f.jsx(e.StrictMode,{children:f.jsx(Me,{})}));
